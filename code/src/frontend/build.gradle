plugins {
    id 'com.github.node-gradle.node'
}

task installWithCI(type: NpmTask) {
    inputs.files "package.json"
    outputs.dir "./node_modules"
    // install with the ci command
    args = ['ci', '--ignore-scripts', '--quiet', '--target_arch=x64']
}

task npm_install(type: NpmTask) {
    // install with more arguments
    args = ['install', '--ignore-scripts', '--quiet', '--target_arch=x64']
}

task build(type: NpmTask,
        group: 'node',
        dependsOn: 'npmLint',
        description: 'Build frontend project'
    ) {
    args = ['run', 'build']
    inputs.dir '.'
    outputs.dir "../../build/resources/main"
}

task npmLint(
        type: NpmTask,
        group: 'node',
        dependsOn: 'installWithCI',
        description: 'Run frontend lint'
) {
    inputs.dir '.'
    outputs.dir "../../build/lint-results"
    args = ['run', 'lint']
}

repositories {
    mavenLocal()
    mavenCentral()
    maven { url 'https://jitpack.io' }
}

node {
    // Version of node to use.
    version = '18.17.1'

    // Version of npm to use.
    npmVersion = '9.8.1'
    download = true
}
